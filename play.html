<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <title>UMNLife</title>
        
        <style>
            body {
                background-image: url('./images/morning_bg.jpg');
                /* Full height */
                height: 100%;

                /* Center and scale the image nicely */
                background-position: center;
                background-repeat: no-repeat;
                background-size: cover;
            }
        </style>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"/>
    </head>
    <body id="play_bg">
        <div class="container-fluid">
            <div class="d-flex m-3 justify-content-center">
                <div class="card shadow p-2" style="width: 12rem;">
                    <div class="d-flex justify-content-center">
                    <img src="./images/exam.png" class="card-img-top img-fluid">
                    </div>
                    <div class="card-body text-center">
                        <h3>MID EXAM</h3>
                    </div>
                </div>
            </div>
            <div class="d-flex m-3 justify-content-center">
                <div class="card shadow p-2" style="width: 30rem;">
                    <div class="d-flex flex-column">
                        <div class="d-flex flex-row justify-content-center">
                            <div class="col m-2">
                                <div class="d-flex flex-row">
                                    <div class="d-flex flex-column mx-2">
                                    <img src="./images/eat.png" width="50px" height="50px">
                                    </div>
                                    <div class="col my-auto">
                                    <div class="progress">
                                        <div id="play_eat" class="progress-bar" style="width: 100%;" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col m-2">
                                <div class="d-flex flex-row">
                                    <div class="d-flex flex-column mx-2">
                                    <img src="./images/sleep.png" width="50px" height="50px">
                                    </div>
                                    <div class="col my-auto">
                                    <div class="progress">
                                        <div id="play_sleep" class="progress-bar" style="width: 100%;" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex flex-row justify-content-center">
                            <div class="col m-2">
                                <div class="d-flex flex-row">
                                    <div class="d-flex flex-column mx-2">
                                    <img src="./images/game.png" width="50px" height="50px">
                                    </div>
                                    <div class="col my-auto">
                                    <div class="progress">
                                        <div id="play_game" class="progress-bar" style="width: 100%;" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col m-2">
                                <div class="d-flex flex-row">
                                    <div class="d-flex flex-column mx-2">
                                    <img src="./images/learn.png" width="50px" height="50px">
                                    </div>
                                    <div class="col my-auto">
                                    <div class="progress">
                                        <div id="play_learn" class="progress-bar" style="width: 10%;" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex flex-row justify-content-center">
                            <h4>Semester <span id="play_smt">1</span></h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex m-3 justify-content-center">
                <div class="d-flex flex-column m-3">
                    <h2 class="text-center text-white"><span id="play_intro">Good Morning</span> <span id="play_name">John Tor</span></h2>
                    <h2 class="text-center text-white"><span id="play_hour">09</span>:<span id="play_min">00</span></h2>
                    <div class="d-flex justify-content-center">
                    <div class="col-12 col-lg-6 col-xs-12 col-md-8 text-center">
                        <img src="./images/char1/idle.png" class="img-fluid" id="play_ava">
                    </div>
                    </div>
                </div>
            </div>
            <div class="d-flex m-3 justify-content-center">
                <div class="row justify-content-center">
                    <div class="col-12 col-lg-5 col-xs-12 col-md-8 m-1 text-center">
                        <button id="play_eat_btn" onclick="doMakan()" class="btn btn-primary w-100">Makan</button>
                    </div>
                    <div class="col-12 col-lg-5 col-xs-12 col-md-8 m-1 text-center">
                        <button id="play_sleep_btn" onclick="doTidur()" class="btn btn-primary w-100">Tidur</button>
                    </div>
                    <div class="col-12 col-lg-5 col-xs-12 col-md-8 m-1 text-center">
                        <button id="play_game_btn" onclick="doMain()" class="btn btn-primary w-100">Main</button>
                    </div>
                    <div class="col-12 col-lg-5 col-xs-12 col-md-8 m-1 text-center">
                        <button id="play_learn_btn" onclick="doBelajar()" class="btn btn-primary w-100">Belajar</button>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            var smt = 1;
            var hour = 9;
            var minute = 0;
            var ava_name = "char";

            var dur_idle = 0;
            var dur_belajar = 0;

            var makan = 50;
            var tidur = 50;
            var main = 50;
            var belajar = 0;

            var makanPrompt = false;
            var tidurPrompt = false;
            var mainPrompt = false;

            var isMakan = false;
            var isTidur = false;
            var isMain = false;
            var isBelajar = false;

            $(document).ready(function() {
                let name = window.localStorage.getItem('name');
                let avatar = window.localStorage.getItem('avatar');

                if(name == null || avatar == null) {
                    window.location.href = "index.html";
                    return;
                }
                
                smt = parseInt(window.localStorage.getItem('smt'));

                ava_name += avatar;

                $('#play_eat').css('width', makan+'%').attr('aria-valuenow', makan);  
                $('#play_sleep').css('width', tidur+'%').attr('aria-valuenow', tidur);  
                $('#play_game').css('width', main+'%').attr('aria-valuenow', main);  
                $('#play_learn').css('width', belajar+'%').attr('aria-valuenow', belajar);   

                $("#play_ava").attr("src","./images/"+ava_name+"/idle.png");
                $("#play_smt").text(smt);

                $("#play_name").text(name);
                setInterval(function() {
                    minute += 5;
                    if(minute >= 60) {
                        hour += 1;
                        minute = 0;
                    }
                    if(hour >= 24)
                        hour = 0;

                    if(hour > 4 && hour <= 11){
                        $("#play_bg").css('background-image', "url('./images/morning_bg.jpg')")
                        $("#play_intro").text("Good Morning");
                    } else if(hour > 11 && hour <= 17) {
                        $("#play_bg").css('background-image', "url('./images/noon_bg.jpg')")
                        $("#play_intro").text("Good Afternoon");
                    } else {
                        $("#play_bg").css('background-image', "url('./images/night_bg.jpg')")
                        $("#play_intro").text("Good Evening");
                    }

                    if(!isMakan && !isTidur && !isMain && !isBelajar) {
                        dur_idle++;
                        if(dur_idle >= 12) {
                            dur_idle = 0;
                            makan -= 10;
                            tidur -= 3;
                            main -= 3;
                        }
                    } else {
                        if(isMakan) {
                            dur_idle++;
                            if(dur_idle >= 12) {
                                dur_idle = 0;
                                tidur -= 3;
                                main -= 3;
                            }
                            makan += 15;
                        } else if(isTidur) {
                            dur_idle++;
                            if(dur_idle >= 20) {
                                dur_idle = 0;
                                makan -= 5;
                            }
                            tidur += 1;
                        } else if(isMain) {
                            dur_idle++;
                            if(dur_idle >= 12) {
                                dur_idle = 0;
                                makan -= 10;
                                tidur -= 3;
                            }
                            main += 5;
                        } else if(isBelajar) {
                            dur_belajar++;
                            if(dur_belajar >= 12) {
                                dur_belajar = 0;
                                belajar += 30;
                                if(belajar >= 100){
                                    belajar = 0;
                                    smt++;
                                    window.localStorage.setItem('smt', smt.toString());
                                }
                            }
                            if(makan < 2 || main < 1 || tidur < 1)
                                doBelajar()
                            else {
                                makan -= 2;
                                main -= 1;
                                tidur -= 1;
                            }
                        }
                    }

                    if(makan < 0)
                        makan = 0;
                    if(tidur < 0)
                        tidur = 0;
                    if(main < 0)
                        main = 0;
                    if(makan > 100)
                        makan = 100;
                    if(tidur > 100)
                        tidur = 100;
                    if(main > 100)
                        main = 100;
                    
                    if(makan < 15 && !makanPrompt) {
                        alert("Karakter sudah lapar, harap Makan!");
                        makanPrompt = true;
                    }
                    if(makan >= 15) {
                        makanPrompt = false;
                    }
                    if(tidur < 10 && !tidurPrompt) {
                        alert("Karakter sudah mengantuk, harap Tidur!");
                        tidurPrompt = true;
                    }
                    if(tidur >= 10) {
                        tidurPrompt = false;
                    }
                    if(main < 10 && !mainPrompt) {
                        alert("Karakter sudah bosan, harap Main!");
                        mainPrompt = true;
                    }
                    if(main >= 10) {
                        mainPrompt = false;
                    }

                    var hs = hour.toString();
                    var ms = minute.toString();
                    if(hs.length < 2)
                        hs = "0"+hs;
                    if(ms.length < 2)
                        ms = "0"+ms;
                    $("#play_hour").text(hs);
                    $("#play_min").text(ms);
                    

                    $('#play_eat').css('width', makan+'%').attr('aria-valuenow', makan);  
                    $('#play_sleep').css('width', tidur+'%').attr('aria-valuenow', tidur);  
                    $('#play_game').css('width', main+'%').attr('aria-valuenow', main);  
                    $('#play_learn').css('width', belajar+'%').attr('aria-valuenow', belajar);  
                    $("#play_smt").text(smt);
                }, 1000);
            });

            function doMakan() {
                isTidur = false;
                isMain = false;
                isBelajar = false;
                if(isMakan) {
                    isMakan = false;
                } else {
                    isMakan = true;
                }
                updatePreview();
            }
            
            function doTidur() {
                isMakan = false;
                isMain = false;
                isBelajar = false;
                if(isTidur) {
                    isTidur = false;
                } else {
                    isTidur = true;
                }
                updatePreview();
            }

            function doMain() {
                isTidur = false;
                isMakan = false;
                isBelajar = false;
                if(isMain) {
                    isMain = false;
                } else {
                    isMain = true;
                }
                updatePreview();
            }

            function doBelajar() {
                isTidur = false;
                isMain = false;
                isMakan = false;
                if(isBelajar) {
                    isBelajar = false;
                } else {
                    isBelajar = true;
                }
                updatePreview();
            }

            function updatePreview() {
                if(isMakan)
                    $('#play_eat_btn').removeClass('btn-primary').addClass('btn-outline-primary').addClass('bg-white');
                else
                    $('#play_eat_btn').removeClass('btn-outline-primary').removeClass('bg-white').addClass('btn-primary');
                    
                if(isTidur)
                    $('#play_sleep_btn').removeClass('btn-primary').addClass('btn-outline-primary').addClass('bg-white');
                else
                    $('#play_sleep_btn').removeClass('btn-outline-primary').removeClass('bg-white').addClass('btn-primary');
                    
                if(isMain)
                    $('#play_game_btn').removeClass('btn-primary').addClass('btn-outline-primary').addClass('bg-white');
                else
                    $('#play_game_btn').removeClass('btn-outline-primary').removeClass('bg-white').addClass('btn-primary');
                    
                if(isBelajar)
                    $('#play_learn_btn').removeClass('btn-primary').addClass('btn-outline-primary').addClass('bg-white');
                else
                    $('#play_learn_btn').removeClass('btn-outline-primary').removeClass('bg-white').addClass('btn-primary');

                if(isMakan)
                    $("#play_ava").attr("src","./images/"+ava_name+"/eating.png");
                else if(isTidur)
                    $("#play_ava").attr("src","./images/"+ava_name+"/sleep.png");
                else if(isMain)
                    $("#play_ava").attr("src","./images/"+ava_name+"/gaming.png");
                else if(isBelajar)
                    $("#play_ava").attr("src","./images/"+ava_name+"/learning.png");
                else
                    $("#play_ava").attr("src","./images/"+ava_name+"/idle.png");
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    </body>
</html>